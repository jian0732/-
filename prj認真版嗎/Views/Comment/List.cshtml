@using prj認真版嗎.ViewModel
@model List<C評論畫面>
@section Styles{
    <style>

    </style>
    <link href="~/css/JianComment.css" rel="stylesheet" />
}
<div class="d-flex justify-content-center">
    <h1>評價管理</h1>
</div>
<div class="big d-flex">
    <div class="左列">
        <div class="input-group">
            <input type="text" class="form-control bg-light border-0 small"
                   placeholder="搜尋" aria-label="Search"
                   aria-describedby="basic-addon2">
            <div class="input-group-append">
                <button class="btn btn-primary" type="button">
                    <i class="fas fa-search fa-sm"></i>
                </button>
            </div>
        </div>
        <div>
            <span class="btn">1星</span><span class="btn">2星</span>
        </div>
        <div id="List">
            <table id="myTable tbl">
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr class="左列的row" onclick="getdata(@item.CommentId)" >
                            <td class="左列的td">
                                <input class="checkchild" type="checkbox" onclick="addtr(@item.CommentId,event)" value="@item.CommentId" >
                            </td>
                            <td>
                                (@item.MembersId)
                            </td>
                            <td>
                                @item.產品名稱 (@item.Star 星)
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    <div>


        <div class="評論內容">
            <div class="標題div">
                <h3 class="標題">評價內容 / 修改</h3>
            </div>
            <div id="comview">

            </div>
        </div>
        <button onclick="gg()" type="button">測試</button>

        <div class="評論內容 多筆DIV" >
            <div class="標題div">
                <h3 class="標題 標題附加">多筆處理</h3>
            </div>
            <div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>
                                留言編號
                            </th>
                            <th>
                                客戶姓名
                            </th>
                            <th>
                                目前狀態
                            </th>
                            <th>
                                留言內容
                            </th>
                        </tr>
                    </thead>
                    <tbody id="coms">


                    </tbody>
                </table>
                <div id="多筆按鈕">
                    <button type="button" onclick="多筆處理(false)" class="btn btn-warning">多筆隱藏</button>
                    <button type="button" onclick="多筆處理(true)" class="btn btn-danger">多筆解除</button>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts{
    <script>

        function getdata(id) {
            $("#comview").load("@Url.Content("~/Comment/Showcomment?id=")" + id)
        }
        function offs(id) {
            $("#comview").load("@Url.Content("~/Comment/offs?id=")" + id)
        }
        function opens(id) {
            $("#comview").load("@Url.Content("~/Comment/opens?id=")" + id)
        }
        let ww = [];
        async function 多筆處理(e) {

            let jsn = { id: ww, bol: e };
            await $.ajax({
                url: "@Url.Content("~/Comment/treat")",
                type: "post",
                data: { bol:jsn},
                dataType: "json",
                success: function (datas) {
                    if (!datas.res) {
                        Swal.fire({
                            trxt:datas.msg,
                            title:'',
                            icon:'error',
                        })
                    }
                    Swal.fire(
                        datas.msg,
                        '',               
                        'success',
                    )
                    ww = [];
                    var checked = document.querySelectorAll('input:checked');
                    checked.forEach(ele => ele.checked = "")  

                }
             })
        }

        function gg() {


        }
        
        function addtr(id, e) {
            if (e.target.checked) {
              $.ajax({
                url: "@Url.Content("~/Comment/getdata")",
                type: "get",
                data: { "CommentId": id },
                dataType: "json"
              }).done(data => {
                  let 狀態 = "";
                  if (data.commentStatus)
                      狀態 = '正常顯示';
                  else
                      狀態 = '隱藏中';
                  let tr = document.createElement("tr");
                  tr.id = data.commentId
                  let text = `<td>${data.commentId}</td>
                              <td>${data.會員名稱}</td>
                              <td>${狀態}</td>
                              <td>${data.commentText}</td>`
                  tr.innerHTML = text
                  $("#coms").append(tr);
              })
                ww.push(id);
                if (ww.length != 0)
                    document.getElementById("多筆按鈕").style.visibility = "visible";//顯示
            }
            else
            {
                $(`#${id}`).remove();
                ww.forEach(function (item, index, arr) {
                    if (item === id) {
                        arr.splice(index, 1);
                    }
                });
                if (ww.length == 0)
                    document.getElementById("多筆按鈕").style.visibility = "hidden";//隱藏
            }
        }
    </script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
}