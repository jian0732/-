@model prj認真版嗎.ViewModel.CCreateTravelProductViewModel

@{ ViewData["Title"] = "建立行程資訊"; }

<h1>建立行程資訊作業</h1>


<hr />
<div class="row">
    <div class="col-md-6">
        <form asp-action="Create" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label asp-for="TravelProductName" class="control-label"></label>
                <input asp-for="TravelProductName" class="form-control" />
                <span asp-validation-for="TravelProductName" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Price" class="control-label"></label>
                <input asp-for="Price" class="form-control" />
                <span asp-validation-for="Price" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="TravelProductTypeId" class="control-label"></label>
                <select asp-for="TravelProductTypeId" class="form-select">
                    <option value="-1">請選擇行程分類</option>
                </select>
            </div>
            <div class="form-group">
                <label asp-for="Stocks" class="control-label"></label>
                <input asp-for="Stocks" class="form-control" />
                <span asp-validation-for="Stocks" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Description" class="control-label"></label>
                <textarea asp-for="Description" class="form-control"></textarea>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="CountryId" class="control-label"></label>
                <select asp-for="CountryId" class="form-select">
                    <option value="-1">請選擇行程所在國家</option>
                </select>
            </div>
            <div class="form-group">
                <label asp-for="Cost" class="control-label"></label>
                <input asp-for="Cost" class="form-control" />
                <span asp-validation-for="Cost" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="EventIntroduction" class="control-label"></label>
                <textarea asp-for="EventIntroduction" class="form-control"></textarea>
                <span asp-validation-for="EventIntroduction" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="PreparationDescription" class="control-label"></label>
                <textarea asp-for="PreparationDescription" class="form-control"></textarea>
                <span asp-validation-for="PreparationDescription" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="MapUrl" class="control-label"></label>
                <input asp-for="MapUrl" class="form-control" />
                <span asp-validation-for="MapUrl" class="text-danger"></span>
            </div>

            =========新增旅遊產品介紹照片=========
            <div id="pic_group">
                <div class="form-group">
                    <label class="control-label">旅遊產品介紹照片</label>
                    <p>Tips:按住ctrl可進行多筆上傳</p>
                    <input type="file" name="photo" multiple />
                </div>
                <div class="form-group">
                    <label asp-for="TravelPictureText" class="control-label"></label>
                    <input asp-for="TravelPictureText" class="form-control" />
                    <span asp-validation-for="TravelPictureText" class="text-danger"></span>
                </div>
            </div>
            ===========新增每日行程明細===========

            <div class="form-group">
                <label asp-for="_TravelProductDetail[0].Day" class="control-label"></label>
                <input asp-for="_TravelProductDetail[0].Day" class="form-control" value="1" readonly="readonly" />
                <span asp-validation-for="_TravelProductDetail[0].Day" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="_TravelProductDetail[0].HotelId" class="control-label"></label>
                <select asp-for="_TravelProductDetail[0].HotelId" id="TravelProductDetail_HotelID" class="form-select">
                    <option value="-1">請選擇下榻飯店</option>
                </select>
            </div>
            <div class="form-group">
                <label asp-for="_TravelProductDetail[0].Date" class="control-label"></label>
                <input type="date" asp-for="_TravelProductDetail[0].Date" class="form-control" />
                <span asp-validation-for="_TravelProductDetail[0].Date" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="_TravelProductDetail[0].DailyDetailText" class="control-label"></label>
                <textarea asp-for="_TravelProductDetail[0].DailyDetailText" class="form-control"></textarea>
                <span asp-validation-for="_TravelProductDetail[0].DailyDetailText" class="text-danger"></span>
            </div>
            ===========新增交通方式===========
            <fieldset>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" name="_TravelProductDetail[0].TrasportationID"  type="checkbox" value="1" id="railway">
                    <label class="form-check-label" for="railway">鐵路</label><br>

                    <input class="form-check-input" name="_TravelProductDetail[0].TrasportationID" type="checkbox" value="2" id="airplane">
                    <label class="form-check-label" for="airplane">飛機</label><br>

                    <input class="form-check-input" name="_TravelProductDetail[0].TrasportationID" type="checkbox" value="3" id="bus" />
                    <label class="form-check-label" for="bus">巴士</label>

                    <input class="form-check-input" name="_TravelProductDetail[0].TrasportationID" type="checkbox" value="4" id="ship" />
                    <label class="form-check-label" for="ship">遊輪</label>
                </div>
            </fieldset>
            ===========選擇行程景點===========
            <div class="form-group">
                <label name="_TravelProductDetail[0].ViewID" class="control-label">選擇行程景點</label>
                <select name="_TravelProductDetail[0].ViewID" class="form-select" id="_ViewV">
                    <option value="-1">請選擇行程景點</option>
                </select>
            </div>

            <div id="createExistView1">
            </div>
            <div>
                <button type="button" onclick="removeExistViewFunc(1)">－選擇景點</button>
                <button type="button" onclick="createExistViewFunc(1)">＋選擇景點</button>
            </div>
            <div id="createNewView1">
            </div>
            <div>
                <button type="button" onclick="removeNewViewFunc(1)">－自訂景點</button>
                <button type="button" onclick="createNewViewFunc(1)">＋自訂景點</button>
            </div>
            ===========新增行程明細===========
            <div id="createNewTravelDetail">

            </div>
            <div>
                <button type="button" onclick="removeNewTravelDetaiFunc()">－行程明細</button>
                <button type="button" onclick="createNewTravelDetaiFunc()">＋行程明細</button>
            </div>
           
            <div class="form-group" style="margin-top:70px">
                <input type="submit" value="建立新行程" class="btn btn-primary" />
            </div>
        </form>


        
    </div>
</div>

<div>
    <a asp-action="list">回到產品一覽表</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
<script>
    //新增、減少行程明細
    let detail_num = 2;
    let CCTPVM_Count = 0; //給CCreateTravelProductViewModel存資料用的Count
    const createNewTravelDetailNode = document.querySelector("#createNewTravelDetail");
    function createNewTravelDetaiFunc()
    {
        _CreateViewCount = 0
        CCTPVM_Count++;
        if (detail_num < 6) {
            let p = document.createElement("div")
            
            const temp =
                `<div class="form-group">` +
                `<label for="Day" class="control-label">行程第${detail_num}天</label>` +
                `<input id="Day" name="_TravelProductDetail[${CCTPVM_Count}].Day" class="form-control" value="${detail_num}" readonly="readonly"/>` +
                `</div>` +
                `<div class="form-group">` +
                `<label for="TravelProductDetail_HotelIDH${detail_num}" class="control-label">住宿地點</label>` +
                `<select id="TravelProductDetail_HotelIDH${detail_num}" name="_TravelProductDetail[${CCTPVM_Count}].HotelId" class="form-select">` +
                `<option value="-1">請選擇下榻飯店</option>` +
                ` </select>` +
                `</div>` +
                `<div class="form-group">` +
                `<label for="Date" class="control-label">日期</label>` +
                `<input type="date" id="Date" name="_TravelProductDetail[${CCTPVM_Count}].Date" class="form-control" />` +
                `</div>` +
                `<div class="form-group">` +
                `<label for="DailyDetailText" class="control-label">每日行程概述</label>` +
                `<textarea id="DailyDetailText" name="_TravelProductDetail[${CCTPVM_Count}].DailyDetailText" class="form-control"></textarea>` +
                `</div>` +
                `=========== 新增交通方式 ===========` +
                `<fieldset>`+
                `<div class="form-check form-check-inline">` +
                `<input class="form-check-input" name="_TravelProductDetail[${CCTPVM_Count}].TrasportationID" type="checkbox" value="1" id="railway${CCTPVM_Count}">` +
                `<label class="form-check-label" for="railway${CCTPVM_Count}">鐵路</label><br>` +
                `<input class="form-check-input" name="_TravelProductDetail[${CCTPVM_Count}].TrasportationID" type="checkbox" value="2" id="airplane${CCTPVM_Count}">` +
                `<label class="form-check-label" for="airplane${CCTPVM_Count}">飛機</label><br>` +
                `<input class="form-check-input" name="_TravelProductDetail[${CCTPVM_Count}].TrasportationID" type="checkbox" value="3" id="bus${CCTPVM_Count}" />` +
                `<label class="form-check-label" for="bus${CCTPVM_Count}">巴士</label>` +
                `<input class="form-check-input" name="_TravelProductDetail[${CCTPVM_Count}].TrasportationID" type="checkbox" value="4" id="ship${CCTPVM_Count}" />` +
                `<label class="form-check-label" for="ship${CCTPVM_Count}">遊輪</label>` +
                `</div>` +
                `</fieldset>`+
                `=========== 選擇行程景點 ===========` +
                `<div class="form-group">` +
                `<label for="_ViewV${detail_num}" class="control-label">選擇行程景點</label>` +
                `<select id="_ViewV${detail_num}" name="_TravelProductDetail[${CCTPVM_Count}].ViewID" class="form-select">` +
                `<option value="-1">請選擇行程景點</option>` +
                `</select>` +
                `</div>` +
                `<div id="createExistViewE${detail_num}">` +
                `</div>` +
                `<div>` +
                `<button type="button" onclick="removeExistViewFunc('E${detail_num}')">－選擇景點</button>` +
                `<button type="button" onclick="createExistViewFunc('E${detail_num}')">＋選擇景點</button>` +
                `</div>` +
                `<div id="createNewViewV${detail_num}">` +
                `</div>` +
                `<div>` +
                `<button type="button" onclick="removeNewViewFunc('V${detail_num}')">－自訂景點</button>` +
                `<button type="button" onclick="createNewViewFunc('V${detail_num}')">＋自訂景點</button>` +
                `</div>` +
                `==================================`;
            p.innerHTML += temp;
            createNewTravelDetailNode.appendChild(p);
            LoadViewName(`V${detail_num}`);
            LoadHotelName(`H${detail_num}`);
            detail_num++;
        }
        else
        {
            detail_num = 6;
            CCTPVM_Count=4;
        }


    };
    function removeNewTravelDetaiFunc() {
        if (detail_num > 2) {
            $(`#createNewTravelDetail`).children().last().remove();
            detail_num--;
            CCTPVM_Count--;
        }
        else
        {
            detail_num = 2;
            CCTPVM_Count=0;
        }

    }
    //新增、減少景點(既有資料)
    let view_exist_num = 0;
    function createExistViewFunc(id) {
        const createExistViewNode = document.querySelector(`#createExistView${id}`);
        let p = document.createElement("div")
        const temp =
            `<div class="form-group">` +
            `<label for="_ViewE${view_exist_num}" class="control-label">景點</label>` +
            `<select name="_TravelProductDetail[${CCTPVM_Count}].ViewID" id="_ViewE${view_exist_num}" class="form-select">` +
            ` <option value="-1">請選擇行程景點</option>` +
            `</select>` +
            `</div>`;

        p.innerHTML += temp;
        createExistViewNode.appendChild(p);
        LoadViewName(`E${view_exist_num}`);
        view_exist_num++;

    }
    function removeExistViewFunc(id) {
        $(`#createExistView${id}`).children().last().remove();

    }
    //新增、減少景點(自訂欄位)
    let view_num = 0;
    let _CreateViewCount = 0;
    function createNewViewFunc(id)
    {
        const createNewViewNode = document.querySelector(`#createNewView${id}`);
            let p = document.createElement("div")
            //const temp =
            //    `<div class="form-group">` +
            //    `<label for="View_CityId${view_num}" class="control-label">城市</label>` +
            //    `<select name="_TravelProductDetail[${CCTPVM_Count}].CreateViewCityID" id="View_CityId${view_num}" class="form-select">` +
            //    ` <option value="-1">請選擇景點所在城市</option>` +
            //    `</select>` +
            //    `<label for="ViewName${view_num}">請輸入景點名字</label>` +
            //    `<input type="text" name="_TravelProductDetail[${CCTPVM_Count}].CreateViewName" id="ViewName${view_num}" />`+
            //    `</div>`;
        const temp =
            `<div class="form-group">` +
            `<label for="View_CityId${view_num}" class="control-label">城市</label>` +
            `<select name="_TravelProductDetail[${CCTPVM_Count}]._CreateView[${_CreateViewCount}].CreateViewCityID" id="View_CityId${view_num}" class="form-select">` +
            ` <option value="-1">請選擇景點所在城市</option>` +
            `</select>` +
            `<label for="ViewName${view_num}">請輸入景點名字</label>` +
            `<input type="text" name="_TravelProductDetail[${CCTPVM_Count}]._CreateView[${_CreateViewCount}].CreateViewName" id="ViewName${view_num}" />` +
            `</div>`;
            p.innerHTML += temp;
            createNewViewNode.appendChild(p);
            LoadCityName();
            view_num++;
            _CreateViewCount++;

    }
    function removeNewViewFunc(id) {
        $(`#createNewView${id}`).children().last().remove();
        if (_CreateViewCount > 0)
            _CreateViewCount--;
        else
            _CreateViewCount = 0;        
    }

    //新增、減少交通方式
    let transportation_num = 0;

    function createNewTransportationFunc(id) {
        const createNewTransportationNode = document.querySelector(`#createNewTransportation${id}`);

            let p = document.createElement("div")
            const temp =
                `<div class="form-group">` +
                `<label for="Trasportation_TrasportationID${transportation_num}" class="control-label">交通</label>` +
                `<select name="_TravelProductDetail[0].TrasportationID" id="Trasportation_TrasportationID${transportation_num}" class="form-select">` +
                ` <option value="-1">新增每日行程交通方式</option>` +
                `</select>` +
                `</div>`;

            p.innerHTML += temp;
            createNewTransportationNode.appendChild(p);
            LoadTrasportationName(transportation_num);
            transportation_num++;

    }
    function removeNewTransportationFunc(id) {
            $(`#createNewTransportation${id}`).children().last().remove();
    }
    //抓資料庫旅遊型態的資料
    async function LoadTravelProductType() {
        let selTravelProductType = document.querySelector("#TravelProductTypeId")
        let response = await fetch("@Url.Content("~/Product/LoadTravelProductType_ReturnJson")")
        let datas = await response.json()
        datas.forEach(TravelProductType => {
            const opt = new Option(TravelProductType['travelProductTypeName'], TravelProductType['travelProductTypeId'])
            selTravelProductType.options.add(opt)
        })
    }
    //抓資料庫國家的名字
    async function LoadCountryName() {
        let selCountryName = document.querySelector("#CountryId")
        let response = await fetch("@Url.Content("~/Product/LoadCountryName_ReturnJson")")
        let datas = await response.json()
        datas.forEach(Country => {
            const opt = new Option(Country['countryName'], Country['countryId'])
            selCountryName.options.add(opt)
        })
    }
    //抓資料庫城市的名字
    async function LoadCityName() {
        let selCityName = document.querySelector(`#View_CityId${view_num}`)
        let response = await fetch("@Url.Content("~/Product/LoadCityName_ReturnJson")")
        let datas = await response.json()
        datas.forEach(City => {
            const opt = new Option(City['cityName'], City['cityId'])
            selCityName.options.add(opt)
        })
    }

    //抓資料庫旅館的名字
        async function LoadHotelName(id) {
            let selHotelName = document.querySelector(`#TravelProductDetail_HotelID${id}`)
        let response = await fetch("@Url.Content("~/Product/LoadHotelName_ReturnJson")")
        let datas = await response.json()
            datas.forEach(Hotel => {
                const opt = new Option(Hotel['hotelName'], Hotel['hotelId'])
                selHotelName.options.add(opt)
        })
    }
    //抓資料庫景點的名字
        async function LoadViewName(id) {
            let selViewName = document.querySelector(`#_View${id}`)
        let response = await fetch("@Url.Content("~/Product/LoadViewName_ReturnJson")")
        let datas = await response.json()
            datas.forEach(View => {
                const opt = new Option(View['viewName'], View['viewId'])
                selViewName.options.add(opt)
        })
    }
    //抓資料庫交通的方式
    @*async function LoadTrasportationName(id) {
        let selTrasportationName = document.querySelector(`#Trasportation_TrasportationID${id}`)
        let response = await fetch("@Url.Content("~/Product/LoadTrasportationName_ReturnJson")")
        let datas = await response.json()
        datas.forEach(Trasportation => {
            const opt = new Option(Trasportation['trasportationName'], Trasportation['trasportationId'])
                selTrasportationName.options.add(opt)
        })
    }*@


    LoadTravelProductType();
    LoadCountryName();
    LoadHotelName("");
    LoadViewName("V");

</script>


}
